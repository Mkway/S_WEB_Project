# JWT (JSON Web Token) 취약점 분석 보고서

## 1. JWT 란?

**상태 비저장(Stateless) 인증 메커니즘 공격하기**

- **JWT란?** 두 개체 사이에서 속성 정보(Claim)를 안전하게 전송하기 위한 간결하고 독립적인 방법을 정의하는 개방형 표준(RFC 7519)입니다.
- **구조:** `헤더(Header).페이로드(Payload).서명(Signature)` 세 부분으로 구성되며, 각 부분은 `.`으로 구분됩니다.
- **주요 용도:** 최신 웹 애플리케이션과 API 환경에서 인증(Authentication) 및 인가(Authorization)를 위해 널리 사용됩니다.

---

## 2. 취약점 1: 서명 알고리즘 없음 (None Algorithm)

**문제점: 서버가 헤더의 `alg` 값을 맹신하는 경우**

- **공격 원리:** 공격자는 JWT 헤더의 `alg` 값을 `"none"`으로 변경하고, 서명(Signature) 부분을 비워서 토큰을 생성합니다.
    ```json
    // 공격자가 조작한 헤더
    {
      "alg": "none",
      "typ": "JWT"
    }
    ```
- **취약한 서버:** `alg` 헤더 값을 검증하지 않는 서버는, 알고리즘이 `"none"`이므로 서명 검증 절차를 생략하고 토큰을 유효한 것으로 처리합니다.
- **영향:** **완벽한 인증 우회.** 공격자는 서명 없이도 원하는 페이로드로 구성된 토큰을 만들어 시스템에 접근할 수 있습니다.

**대응 방안:**
- 서버 측에서 허용할 알고리즘 목록(Whitelist)을 명시적으로 관리합니다.
- `alg` 값이 `"none"`인 토큰은 무조건 거부해야 합니다.

---

## 3. 취약점 2: 알고리즘 혼동 (Algorithm Confusion)

**문제점: 비대칭 키(RS256)를 대칭 키(HS256)처럼 사용하는 경우**

- **공격 원리:**
    1.  서버는 **RS256** (비대칭 키) 알고리즘으로 서명된 토큰을 기대합니다. (개인키로 서명, 공개키로 검증)
    2.  공격자는 서버로부터 **공개키**를 획득합니다. (공개키는 이름 그대로 외부에 공개되어 있습니다.)
    3.  공격자는 `alg` 헤더를 **HS256** (대칭 키)으로 변경하고, 획득한 **공개키**를 HS256의 비밀 키(secret)처럼 사용하여 토큰을 서명합니다.
    4.  취약한 서버는 `alg`가 HS256인 것을 보고, 자신이 가진 **공개키**를 비밀 키로 착각하여 서명을 검증합니다. 공격자가 공개키로 서명했으므로, 검증은 성공합니다.
- **영향:** **토큰 위조 및 인증 우회.** 공격자가 원하는 내용으로 토큰을 만들어낼 수 있습니다.

**대응 방안:**
- 서버에서 사용할 JWT 알고리즘을 단 하나로 고정하고, 다른 알고리즘으로 서명된 토큰은 모두 거부해야 합니다.

---

## 4. 취약점 3: 약한 비밀 키 (Weak Secret)

**문제점: HS256 알고리즘에 추측 가능한 약한 비밀 키를 사용하는 경우**

- **공격 원리:** HS256 알고리즘의 비밀 키가 `secret`, `123456`, `password`처럼 너무 단순하면, 공격자는 사전 공격(Dictionary Attack)이나 무차별 대입 공격(Brute-force)을 통해 비밀 키를 알아낼 수 있습니다.
- **영향:** 비밀 키가 노출되면, 공격자는 해당 키를 사용하여 서버를 완벽하게 속일 수 있는 유효한 토큰을 무제한으로 생성할 수 있습니다.

**대응 방안:**
- 절대 추측할 수 없는, **충분히 길고 복잡한 랜덤 문자열**을 비밀 키로 사용해야 합니다. (최소 256비트 이상 권장)
- 비밀 키를 소스 코드에 하드코딩하지 말고, 안전한 저장소에 보관해야 합니다.
- 정기적으로 비밀 키를 교체하는 정책을 수립합니다.

---

## 5. JWT 공격 방어 전략

1.  **신뢰할 수 있는 최신 JWT 라이브러리 사용:** 직접 JWT를 구현하지 말고, 보안적으로 검증된 라이브러리를 사용합니다.
2.  **강력한 알고리즘 강제:** 서버에서 사용할 알고리즘을 하나로 고정하고, `alg: "none"`을 포함한 다른 모든 알고리즘을 거부합니다.
3.  **강력한 키 사용 및 관리:** HS256에는 강력한 비밀 키를, RS256에는 안전하게 보관된 개인키를 사용합니다.
4.  **페이로드에 민감 정보 포함 금지:** 페이로드는 Base64로 인코딩되었을 뿐, 암호화된 것이 아니므로 누구나 내용을 볼 수 있습니다. 민감 정보는 절대 포함하지 않습니다. (필요시 JWE 사용 고려)
5.  **토큰 만료 시간(`exp`) 설정 및 검증:** 모든 토큰에 짧은 만료 시간을 설정하고, 서버는 만료 여부를 반드시 검증해야 합니다.
6.  **토큰 폐기 메커니즘 구현:** 사용자가 로그아웃하거나 토큰이 탈취되었을 때, 해당 토큰을 강제로 무효화할 수 있는 방법(예: 블랙리스트)을 마련합니다.
