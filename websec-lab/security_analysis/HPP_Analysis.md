# HPP (HTTP Parameter Pollution) 분석 보고서

## 1. HPP 란?

**웹 애플리케이션의 모호함을 이용한 공격**

- **HPP란?** HTTP Parameter Pollution의 약자로, 공격자가 동일한 이름의 HTTP 매개변수를 여러 번 전송하여 웹 애플리케이션의 정상적인 로직을 우회하거나 교란시키는 공격 기법입니다.
- **원리:** 웹 서버, 프로그래밍 언어, 프레임워크마다 동일한 이름의 파라미터를 처리하는 방식(첫 번째 값을 사용하는지, 마지막 값을 사용하는지, 모든 값을 배열로 처리하는지 등)이 모두 다릅니다. 공격자는 이 불일치와 모호성을 악용합니다.
- **영향:**
    - **인증 및 보안 필터 우회:** 웹 방화벽(WAF)이나 보안 로직을 우회하여 XSS, SQL Injection 등 다른 공격을 성공시킬 수 있습니다.
    - **비즈니스 로직 교란:** 가격, 수량 등 중요한 값을 조작하여 금전적 피해를 유발합니다.
    - **캐시 독으로(Cache Poisoning):** 웹 캐시에 오염된 페이지를 저장하여 다른 사용자에게 영향을 줍니다.

---

## 2. 모호함의 문제: 파라미터 처리 방식의 차이

`?color=red&color=blue` 요청은 어떻게 해석될까요?

| 기술 스택 | 처리 결과 |
| :--- | :--- |
| **PHP / Apache** | `blue` (마지막 값) |
| **ASP.NET / IIS** | `red,blue` (쉼표로 연결된 문자열) |
| **Python / Django** | `blue` (마지막 값) |
| **Node.js / Express** | `['red', 'blue']` (배열) |
| **Java / Tomcat** | `red` (첫 번째 값) |

이러한 **불일치**가 바로 HPP 취약점의 근원입니다.

---

## 3. 공격 시나리오: 웹 방화벽(WAF) 우회

**공격 목표:** 웹 방화벽을 우회하여 SQL Injection 공격 성공시키기

**공격 환경:**
- **웹 방화벽(WAF):** 요청을 검사할 때, 중복된 파라미터 중 **첫 번째 값**만 확인하도록 설정되어 있음.
- **웹 애플리케이션:** **PHP**로 작성되어, 중복된 파라미터 중 **마지막 값**을 사용함.

**공격용 악성 페이로드:**
`?id=1&id=2' OR 1=1--`

**공격 과정:**
1.  요청이 WAF에 도달하면, WAF는 첫 번째 `id` 파라미터인 `id=1`만 검사합니다. 이 값은 안전하므로 요청을 통과시킵니다.
2.  요청이 PHP 애플리케이션에 도달하면, PHP는 마지막 `id` 파라미터인 `id=2' OR 1=1--` 값을 사용합니다.
3.  결과적으로 WAF는 우회되고, 악의적인 SQL Injection 구문이 데이터베이스에서 성공적으로 실행됩니다.

---

## 4. 해결책: 방어적 프로그래밍

**가장 안전한 방법: 기본 동작에 의존하지 않고 명시적으로 처리하기**

1.  **내 기술 스택 이해하기:** 내가 사용하는 웹 서버, 언어, 프레임워크가 중복 파라미터를 어떻게 처리하는지 정확히 파악해야 합니다.
2.  **명시적으로 값 가져오기:** 프레임워크가 제공하는 기능을 사용하여, 첫 번째 값, 마지막 값, 또는 모든 값을 배열로 가져올지 명확하게 지정합니다.

    ```php
    // 특정 프레임워크의 가상 코드 예시
    
    // 첫 번째 값만 가져오기
    $id = $request->getParam('id', 'first');
    
    // 마지막 값만 가져오기
    $id = $request->getParam('id', 'last');
    
    // 모든 값을 배열로 가져오기
    $ids = $request->getParam('id', 'all');
    ```
3.  **모호한 요청 거부:** 단일 값만 예상되는 파라미터에 중복된 값이 들어오면, 요청 자체를 유효하지 않은 것으로 간주하고 거부하도록 설정합니다.

---

## 5. HPP 방어 전략

1.  **인지하기:** HPP 공격의 첫걸음은 내가 사용하는 기술 스택이 중복 파라미터를 어떻게 처리하는지 인지하는 것입니다.
2.  **검증된 웹 프레임워크 사용:** 최신 웹 프레임워크는 대부분 HPP 공격을 방어할 수 있는 일관되고 안전한 파라미터 처리 방식을 제공합니다.
3.  **입력값 검증 로직 강화:** 파라미터 검증 시, 단일 값이 와야 할 곳에 배열이 들어오는 경우를 예상하고 방어해야 합니다.
4.  **WAF 설정 확인:** 웹 방화벽을 사용한다면, 방화벽의 파라미터 처리 방식이 실제 백엔드 애플리케이션의 처리 방식과 동일하게 설정되었는지 반드시 확인해야 합니다.
