# GraphQL Injection 분석 보고서

## 1. GraphQL 취약점

**유연한 쿼리가 보안 위험이 될 때**

- **GraphQL이란?** API를 위한 쿼리 언어이자, 해당 쿼리를 기존 데이터로 채우기 위한 런타임입니다. 클라이언트가 필요한 데이터를 정확히 요청할 수 있게 해줍니다.
- **주요 특징:**
    - **단일 엔드포인트:** 모든 요청이 하나의 엔드포인트로 전송됩니다.
    - **강력한 타입 스키마:** 데이터 구조를 명확하게 정의합니다.
    - **중첩 쿼리:** 클라이언트가 관련된 데이터를 단일 쿼리로 요청할 수 있습니다.
- **인기 요인:** 과도한 데이터 가져오기/부족한 데이터 가져오기 문제를 줄여주고, 클라이언트-서버 통신을 효율적으로 만듭니다.

---

## 2. 취약점 1: 스키마 인트로스펙션 (Schema Introspection)

**문제점: 전체 API 구조 노출**

- **취약점:** GraphQL 서버는 기본적으로 '인트로스펙션' 쿼리(`__schema`, `__type` 등)를 허용하여, 클라이언트가 전체 API 스키마(타입, 필드, 뮤테이션 등)를 발견할 수 있게 합니다.
- **영향:** 정보 노출. 공격자는 모든 사용 가능한 타입, 필드, 뮤테이션, 심지어 숨겨진 필드나 내부 타입까지 발견하여, 더욱 정교한 공격을 계획할 수 있습니다.

**해결책:**
- **운영 환경에서는 스키마 인트로스펙션을 비활성화합니다.**

---

## 3. 취약점 2: 깊이 공격 (Depth Attack, DoS)

**문제점: 깊게 중첩된 쿼리로 인한 서버 리소스 고갈**

- **취약점:** GraphQL은 깊게 중첩된 쿼리(예: `user { posts { comments { author { posts { ... } } } } }`)를 허용합니다. 제한이 없으면, 공격자는 과도하게 중첩된 쿼리를 만들어 서버가 엄청난 양의 작업을 수행하게 하여 서비스 거부(DoS)를 유발할 수 있습니다.
- **영향:** 서버 리소스 고갈, 응답 지연, 서비스 중단.

**해결책:**
- **쿼리 깊이 제한을 구현합니다.** (예: 5-10 레벨)

---

## 4. 취약점 3: 필드 추측 (Field Suggestion)

**문제점: 에러 메시지를 통한 스키마 정보 유출**

- **취약점:** 일부 GraphQL 구현은 유효하지 않은 필드 이름이 제공될 때 올바른 필드 이름을 제안하는 유용한 에러 메시지(예: "Cannot query field `secret_key` on type `User`. Did you mean `secretToken`?")를 제공합니다.
- **영향:** 정보 노출. 공격자는 유효하지 않은 필드를 시도하고 에러 메시지를 관찰하여, 숨겨지거나 민감한 필드 이름을 열거할 수 있습니다.

**해결책:**
- **운영 환경에서는 상세한 에러 메시지를 최소화합니다.**

---

## 5. 취약점 4: 배치 공격 (Batch Attack)

**문제점: 단일 요청으로 여러 쿼리를 보내 속도 제한 우회**

- **취약점:** GraphQL은 단일 HTTP 요청으로 여러 쿼리를 보낼 수 있습니다(쿼리 배치). 만약 속도 제한이 요청당 적용된다면, 공격자는 단일 배치에 많은 쿼리를 보내 속도 제한을 효과적으로 우회하여 무차별 대입 공격이나 데이터 유출을 훨씬 빠르게 수행할 수 있습니다.
- **영향:** 무차별 대입 공격(예: 비밀번호 추측), 속도 제한 우회, 서버 부하 증가.

**해결책:**
- **쿼리 복잡도 또는 리소스 사용량에 기반한 속도 제한을 구현합니다.** (요청당이 아님)
- **단일 배치에서 허용되는 작업 수를 제한합니다.**

---

## 6. GraphQL 취약점 방어 전략

1.  **운영 환경에서 인트로스펙션 비활성화:** 공격자가 API 스키마를 쉽게 발견하는 것을 방지합니다.
2.  **쿼리 깊이 제한:** DoS 공격을 방지하기 위해 쿼리의 최대 깊이를 설정합니다.
3.  **쿼리 복잡도/비용 분석:** 쿼리의 계산 비용을 계산하고, 미리 정의된 임계값을 초과하는 복잡한 쿼리는 거부하는 시스템을 구현합니다.
4.  **속도 제한 구현:** 요청당이 아닌 쿼리 복잡도 또는 리소스 사용량에 기반한 속도 제한을 적용합니다.
5.  **필드 레벨 인가:** 리졸버가 각 필드에 대한 인가를 강제하도록 하여, 사용자가 허용된 데이터만 접근하도록 합니다.
6.  **상세한 에러 메시지 최소화:** 에러 메시지를 통해 민감한 스키마 정보가 유출되는 것을 방지합니다.
7.  **입력값 검증 및 정제:** 리졸버로 전달되는 모든 사용자 입력이 적절하게 검증되고 정제되어 백엔드 인젝션 공격을 방지하도록 합니다.
