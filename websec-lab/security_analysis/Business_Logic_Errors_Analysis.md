# Business Logic Errors 분석 보고서

## 1. 비즈니스 로직 오류 (Business Logic Errors)

**애플리케이션의 '작동 방식'을 악용하다**

- **정의:** 애플리케이션의 비즈니스 규칙(업무 처리 흐름)을 설계하거나 구현하는 과정에서 발생하는 논리적 결함으로 인한 취약점입니다. 기술적인 보안 취약점(SQL Injection, XSS 등)과는 다르게, 애플리케이션의 정상적인 기능을 악용합니다.
- **원리:** 공격자는 애플리케이션의 '무엇을 하는가'가 아닌 '어떻게 하는가'에 집중하여, 개발자가 의도하지 않은 방식으로 시스템을 조작하거나 우회하여 부당한 이득을 취합니다.
- **영향:**
    - **금전적 사기:** 가격 조작, 수량 조작, 환불 시스템 악용 등으로 금전적 이득을 취합니다.
    - **무단 접근 및 권한 상승:** 워크플로우 우회, 상태 조작 등을 통해 비정상적인 접근 권한을 획득합니다.
    - **데이터 조작:** 재고 조작, 사용자 정보 변경 등 데이터의 무결성을 훼손합니다.
    - **서비스 거부(DoS):** 비효율적인 로직을 반복 호출하여 시스템에 과부하를 유발합니다.

---

## 2. 취약점 1: 가격 조작 (Price Manipulation)

**문제점: 상품 가격에 대한 불충분한 검증**

- **취약점:** 애플리케이션이 상품 구매 과정에서 사용자가 전송하는 가격(Price) 값을 서버 측에서 제대로 검증하지 않을 때 발생합니다.
- **공격 시나리오:**
    - **음수 가격:** 공격자가 상품 가격을 `-1000원` 등으로 조작하여 전송하면, 시스템이 이를 처리하여 오히려 공격자의 잔액이 증가합니다.
    - **0원 가격:** 가격을 `0원`으로 조작하여 상품을 무료로 구매합니다.
    - **소수점 오류:** `0.00001원`과 같이 매우 작은 소수점 가격으로 고가 상품을 구매합니다.
- **해결책:**
    - **서버 측 가격 검증:** 모든 상품의 가격은 반드시 서버 측에서 관리하며, 클라이언트에서 전송된 가격이 서버의 정해진 가격과 일치하는지 확인합니다.
    - **유효 범위 검증:** 가격이 `0`보다 크고, 허용된 최대 가격 범위 내에 있는지 확인합니다.

---

## 3. 취약점 2: 워크플로우 우회 (Workflow Bypass)

**문제점: 다단계 프로세스의 필수 단계 생략 또는 순서 변경**

- **취약점:** 애플리케이션이 사용자에게 특정 순서로 진행되어야 하는 다단계 프로세스(예: 회원가입, 주문)에서, 공격자가 필수적인 단계를 건너뛰거나 순서를 변경하여 비정상적인 상태에 도달하는 공격입니다.
- **공격 시나리오:**
    - **이메일 인증 우회:** 이메일 인증 없이 계정을 활성화하는 API를 직접 호출하여 유효하지 않은 이메일로 계정을 생성합니다.
    - **결제 없이 주문 완료:** 결제 단계를 건너뛰고 주문 완료 API를 직접 호출하여 상품을 무료로 획득합니다.
- **해결책:**
    - **상태 머신 구현:** 각 단계의 전제 조건과 다음 단계로의 유효한 전환 규칙을 서버 측에서 엄격하게 관리하는 상태 머신(State Machine)을 구현합니다.
    - **모든 단계 서버 측 검증:** 클라이언트에서 모든 단계가 정상적으로 완료되었는지 서버에서 재확인합니다.

---

## 4. 취약점 3: 상태 조작 (State Manipulation)

**문제점: 객체의 비정상적인 상태 전환 허용**

- **취약점:** 애플리케이션이 객체(예: 주문, 사용자 계정)의 상태를 변경할 때, 유효하지 않거나 비정상적인 상태 전환을 허용하는 경우 발생합니다.
- **공격 시나리오:**
    - **환불 후 상품 수령:** 주문 상태를 '취소됨'에서 '배송 완료'로 직접 변경하여, 환불을 받은 후에도 상품을 수령합니다.
    - **결제 없이 완료 처리:** '결제 대기' 상태의 주문을 '완료됨' 상태로 직접 변경하여 상품을 무료로 얻습니다.
- **해결책:**
    - **엄격한 상태 전환 로직:** 각 상태에서 다음 상태로의 유효한 전환만을 허용하도록 서버 측에서 엄격한 로직을 구현합니다.
    - **권한 검증:** 상태 변경을 요청하는 사용자가 해당 상태 변경을 수행할 권한이 있는지 확인합니다.

---

## 5. 비즈니스 로직 오류 방어 전략

1.  **엄격한 서버 측 검증 (필수):** 클라이언트 측의 모든 입력과 로직은 신뢰하지 않고, 모든 비즈니스 규칙과 제약 조건은 반드시 서버 측에서 재검증하고 강제해야 합니다.
2.  **상태 머신 구현:** 다단계 프로세스나 객체 상태 관리가 필요한 경우, 명확한 상태 정의와 유효한 상태 전환 규칙을 가진 상태 머신을 구현하여 비정상적인 흐름을 차단합니다.
3.  **포괄적인 입력값 검증:** 기술적인 보안(SQL Injection 등)뿐만 아니라, 비즈니스 로직의 유효성(예: 수량은 0보다 커야 함, 가격은 특정 범위 내여야 함)까지 모든 사용자 입력값을 검증합니다.
4.  **시간 동기화 및 서버 시간 사용:** 시간 기반 로직(쿠폰 유효 기간, 경매 마감 시간 등)은 클라이언트 시간이 아닌 서버 시간을 기준으로 처리하고, 시간 조작 공격에 대비합니다.
5.  **철저한 코드 리뷰 및 수동 테스트:** 비즈니스 로직 오류는 자동화된 도구로 탐지하기 어렵습니다. 개발 단계에서의 철저한 코드 리뷰와, 실제 시나리오 기반의 수동 침투 테스트가 필수적입니다.
6.  **상세한 로깅 및 모니터링:** 모든 중요한 비즈니스 트랜잭션을 상세히 로깅하고, 비정상적인 패턴이나 예상치 못한 동작을 실시간으로 모니터링하여 공격 시도를 조기에 탐지합니다.
