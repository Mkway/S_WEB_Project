# Vulnerability Mode Analysis

## 1. `vulnerability_toggle.php` 분석

이 스크립트는 애플리케이션의 "취약점 모드"를 토글하는 관리 도구입니다. 관리자가 테스트 및 교육 목적으로 보안 상태와 취약한 상태를 전환할 수 있도록 설계되었습니다.

### 작동 방식:

1.  **관리자 확인:** 사용자가 로그인되어 있고 관리자 권한이 있는지 확인합니다(`require_admin()`).
2.  **CSRF 보호:** 무단 토글을 방지하기 위해 CSRF 토큰 확인(`verify_csrf_token()`)을 포함합니다.
3.  **설정 파일:** `vulnerability_config.json` 파일을 읽고 씁니다. 이 JSON 파일은 `vulnerability_mode`의 현재 상태를 저장합니다.
4.  **토글 로직:** `VULNERABILITY_MODE`의 부울 값을 뒤집거나(정의된 경우) 정의되지 않은 경우 `true`로 설정합니다.
5.  **로깅:** `log_security()`를 사용하여 모드 변경을 기록합니다.
6.  **리디렉션:** 처리 후 `admin.php`로 리다이렉션합니다.

## 2. `vulnerability_toggle.php` 사용 시 코드 변경 사항

`vulnerability_toggle.php` 자체는 애플리케이션의 코드를 직접 변경하지 않습니다. 대신 `vulnerability_config.json`에 저장된 **구성 설정**을 변경합니다.

실제 코드 변경(즉, 보안 조치 활성화/비활성화)은 이 `vulnerability_config.json` 파일을 **읽고** `vulnerability_mode` 설정을 기반으로 작동하는 애플리케이션의 다른 부분에서 발생합니다.

### 핵심 파일: `config.php`

`config.php` 파일은 `vulnerability_config.json`을 읽고 `VULNERABILITY_MODE` 상수를 정의합니다. 이 상수는 애플리케이션 전반에 걸쳐 사용됩니다.

```php
// config.php 스니펫
$vulnerability_mode = true; // 기본값
$config_file = __DIR__ . '/vulnerability_config.json';

if (file_exists($config_file)) {
    $config_data = json_decode(file_get_contents($config_file), true);
    if (isset($config_data['vulnerability_mode'])) {
        $vulnerability_mode = (bool)$config_data['vulnerability_mode'];
    }
}

define('VULNERABILITY_MODE', $vulnerability_mode); // true: 취약점 허용, false: 보안 강화
```

## 3. 코드 변경 예시 및 영향

`VULNERABILITY_MODE` 상수는 보안 조치를 조건부로 활성화하거나 비활성화하는 데 사용됩니다. `VULNERABILITY_MODE`가 `true`이면 애플리케이션은 덜 안전하게 동작하여 특정 취약점을 시연할 수 있습니다. `VULNERABILITY_MODE`가 `false`이면 보안 조치가 적용됩니다.

### 예시 1: `view_post.php` (댓글 게시 - XSS/SQLi 관련)

*   **취약 모드 (`VULNERABILITY_MODE === true`):**
    코드가 입력 정제를 건너뛰거나 댓글에 취약한 SQL 쿼리를 사용하여 XSS 또는 SQL Injection을 허용할 수 있습니다.
*   **보안 모드 (`VULNERABILITY_MODE === false`):**
    코드는 엄격한 입력 정제(예: `htmlspecialchars()`)를 적용하고 데이터베이스 상호 작용에 준비된 문을 사용하여 XSS 및 SQL Injection을 방지합니다.

### 예시 2: `create_post.php` (게시물 생성 - XSS/SQLi 관련)

`view_post.php`와 유사하게 `create_post.php`는 게시물 생성 중 입력 정제 및 데이터베이스 상호 작용에 대한 조건부 로직을 가지고 있을 가능성이 높습니다.

### 예시 3: `admin.php` (관리자 패널 표시)

`admin.php`는 현재 모드에 따라 다른 메시지나 UI 요소를 표시하여 취약점 모드의 현재 상태를 나타냅니다.

```php
// admin.php 스니펫
<?php if (defined('VULNERABILITY_MODE') && VULNERABILITY_MODE === true): ?>
    <!-- 취약점 모드 활성화 시 표시될 내용 -->
<?php endif; ?>

<?php echo (defined('VULNERABILITY_MODE') && VULNERABILITY_MODE === true) ? '🛡️ 보안 모드로 전환' : '⚠️ 취약점 모드로 전환'; ?>
```

## 4. 토글링의 영향

*   **취약 모드 (`VULNERABILITY_MODE = true`):**
    *   **목적:** 교육 및 테스트 목적. 다양한 웹 취약점 시연을 허용합니다.
    *   **영향:** 애플리케이션이 의도적으로 안전하지 않게 됩니다. 입력 정제, 준비된 문, 엄격한 유효성 검사와 같은 보안 조치가 우회되거나 약화될 수 있습니다. 이를 통해 공격자(또는 테스터)는 SQL Injection, XSS 등과 같은 취약점을 성공적으로 악용할 수 있습니다.
    *   **위험:** **높음**. 프로덕션 환경에서는 절대 사용해서는 안 됩니다. 데이터가 손상될 수 있으며 서버가 장악될 수 있습니다.

*   **보안 모드 (`VULNERABILITY_MODE = false`):**
    *   **목적:** 웹 애플리케이션을 올바르게 보호하는 방법을 시연합니다.
    *   **영향:** 애플리케이션은 보안 모범 사례를 적용합니다. 입력은 정제되고, 준비된 문이 사용되며, 다른 보안 제어가 활성화됩니다. 이는 취약 모드에서 시연된 취약점의 성공적인 악용을 방지합니다.
    *   **이점:** 개발 및 배포를 위한 안전한 기준을 제공합니다.

## 5. 요약

`vulnerability_toggle.php`는 `vulnerability_config.json`의 설정을 변경합니다. 이 설정은 `config.php`에서 읽혀 `VULNERABILITY_MODE` 상수를 정의합니다. 애플리케이션의 다른 PHP 파일들은 이 상수를 사용하여 보안 기능을 조건부로 활성화하거나 비활성화하여, 교육 목적으로 애플리케이션을 보안 상태와 의도적으로 취약한 상태 사이에서 전환합니다.

이를 통해 프로젝트는 취약한 코드와 안전한 코드 모두에 대한 실용적인 시연 역할을 할 수 있습니다.
